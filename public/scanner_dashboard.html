<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scanner | School Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #eef2f5;
            /* Pastel Gradient */
            background-image: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
        }

        /* Claymorphism Utilities */
        .clay-card {
            background: #eef2f5;
            border-radius: 40px;
            /* Double shadow for floating effect */
            box-shadow:
                35px 35px 70px #c8c9cc,
                -35px -35px 70px #ffffff;
            border: 8px solid rgba(255, 255, 255, 0.4);
        }

        .clay-inner {
            border-radius: 30px;
            /* Inflated Look via Inner Shadow */
            box-shadow: inset 8px 8px 16px #d1d9e6,
                inset -8px -8px 16px #ffffff;
            background: #eef2f5;
        }

        .clay-text {
            color: #6d7587;
            text-shadow: 2px 2px 4px rgba(163, 177, 198, 0.3),
                -2px -2px 4px rgba(255, 255, 255, 0.8);
        }

        /* Scanner Overlay Customization */
        #reader {
            border-radius: 24px;
            overflow: hidden;
        }

        #reader video {
            object-fit: cover;
            border-radius: 24px;
        }
    </style>
</head>

<body class="h-screen flex flex-col items-center justify-center p-6 bg-slate-100 overflow-hidden">

    <!-- Floating Background Blobs for Atmosphere -->
    <div
        class="fixed top-[-10%] left-[-10%] w-96 h-96 bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob">
    </div>
    <div
        class="fixed top-[-10%] right-[-10%] w-96 h-96 bg-pink-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000">
    </div>
    <div
        class="fixed bottom-[-20%] left-[20%] w-96 h-96 bg-indigo-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-4000">
    </div>

    <!-- Main Clay Card -->
    <div
        class="clay-card relative w-full max-w-md p-6 flex flex-col items-center z-10 transform transition-all duration-500 hover:scale-[1.02]">

        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-3xl font-black text-slate-700 tracking-tight clay-text">SCANNER</h1>
            <p class="text-sm font-bold text-slate-400 mt-1 uppercase tracking-widest">School ID System</p>
        </div>

        <!-- Scanner Viewport (Inflated Frame) -->
        <div class="clay-inner p-3 w-full aspect-square flex items-center justify-center mb-6 relative group">
            <!-- Real Scanner -->
            <div id="reader" style="width: 100%; height: 100%;" class="bg-slate-200 rounded-[24px]"></div>

            <!-- Decorative Scan Line -->
            <div class="absolute inset-4 pointer-events-none border-2 border-white/50 rounded-[20px] z-20"></div>
        </div>

        <!-- Status Pill -->
        <div class="clay-inner px-8 py-4 rounded-full flex items-center gap-3">
            <div id="statusDot" class="w-3 h-3 rounded-full bg-slate-300 shadow-inner"></div>
            <p id="statusMsg" class="text-sm font-bold text-slate-500">Initializing Camera...</p>
        </div>

        <!-- No Exit Button (As Requested) -->
    </div>

    <!-- Script Logic (Identical to before) -->
    <script>
        const html5QrCode = new Html5Qrcode("reader");
        const statusEl = document.getElementById('statusMsg');
        const statusDot = document.getElementById('statusDot');

        const qrConfig = { fps: 10, qrbox: { width: 250, height: 250 } };

        const onScanSuccess = (decodedText, decodedResult) => {
            console.log(`Code matched = ${decodedText}`, decodedResult);

            try {
                // Check if it's our JSON format
                const data = JSON.parse(decodedText);

                if (data.f) {
                    // Valid Filter QR
                    html5QrCode.stop().then(() => {
                        statusMsg.innerText = "Redirecting...";
                        statusDot.className = "w-3 h-3 rounded-full bg-emerald-400 shadow-[0_0_10px_#34d399]";

                        const filterParam = encodeURIComponent(decodedText);
                        setTimeout(() => {
                            window.location.href = `student_view.html?filters=${filterParam}`;
                        }, 300);
                    });
                }
                else if (data.id) {
                    // Valid Individual Student QR
                    html5QrCode.stop().then(() => {
                        statusMsg.innerText = "Student Found!";
                        statusDot.className = "w-3 h-3 rounded-full bg-indigo-500 shadow-[0_0_10px_#6366f1]";

                        const studentParam = encodeURIComponent(decodedText);
                        setTimeout(() => {
                            window.location.href = `student_view.html?student=${studentParam}`;
                        }, 300);
                    });
                }
                else {
                    statusMsg.innerText = "Invalid QR Format";
                    statusDot.className = "w-3 h-3 rounded-full bg-amber-400 shadow-[0_0_10px_#fbbf24]";
                }
            } catch (e) {
                statusMsg.innerText = "Unknown QR";
                statusDot.className = "w-3 h-3 rounded-full bg-rose-400 shadow-[0_0_10px_#fb7185]";
            }
        };

        const onScanFailure = (error) => {
            // handle scan failure silently
        };

        // Start
        html5QrCode.start({ facingMode: "environment" }, qrConfig, onScanSuccess, onScanFailure)
            .then(() => {
                statusEl.innerText = "Ready to Scan";
                statusDot.className = "w-3 h-3 rounded-full bg-emerald-400 animate-pulse";
            })
            .catch(err => {
                statusEl.innerText = "Camera Error";
                statusDot.className = "w-3 h-3 rounded-full bg-rose-500";
            });
    </script>

    <!-- Tailwind Config for Animation -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        blob: "blob 7s infinite",
                    },
                    keyframes: {
                        blob: {
                            "0%": { transform: "translate(0px, 0px) scale(1)" },
                            "33%": { transform: "translate(30px, -50px) scale(1.1)" },
                            "66%": { transform: "translate(-20px, 20px) scale(0.9)" },
                            "100%": { transform: "translate(0px, 0px) scale(1)" },
                        },
                    },
                },
            },
        }
    </script>
</body>

</html>